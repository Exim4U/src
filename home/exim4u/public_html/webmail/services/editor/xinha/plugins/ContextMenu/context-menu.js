Xinha.loadStyle("menu.css","ContextMenu");function ContextMenu(A){this.editor=A}ContextMenu._pluginInfo={name:"ContextMenu",version:"1.0",developer:"Mihai Bazon",developer_url:"http://dynarch.com/mishoo/",c_owner:"dynarch.com",sponsor:"American Bible Society",sponsor_url:"http://www.americanbible.org",license:"htmlArea"};Xinha.Config.prototype.ContextMenu={disableMozillaSpellCheck:false};ContextMenu.prototype.onGenerate=function(){var B=this;var A=this.editordoc=this.editor._iframe.contentWindow.document;Xinha._addEvents(A,["contextmenu"],function(C){return B.popupMenu(Xinha.is_ie?B.editor._iframe.contentWindow.event:C)});this.currentMenu=null;if(this.editor.config.ContextMenu.disableMozillaSpellCheck){this.editordoc.body.spellcheck=false}};ContextMenu.prototype.getContextMenu=function(H){var F=this;var D=this.editor;var C=D.config;var B=[];var L=this.editor.plugins.TableOperations;if(L){L=L.instance}var K=D.hasSelectedText();if(!Xinha.is_gecko){if(K){B.push([Xinha._lc("Cut","ContextMenu"),function(){D.execCommand("cut")},null,C.btnList.cut[1]],[Xinha._lc("Copy","ContextMenu"),function(){D.execCommand("copy")},null,C.btnList.copy[1]]);B.push([Xinha._lc("Paste","ContextMenu"),function(){D.execCommand("paste")},null,C.btnList.paste[1]])}}var J=H;var I=[];var G=null;var E=null;var A=null;var M=null;var R=null;function N(S){L.buttonPress(D,S)}function O(V){var U=J;var T=U.parentNode;var X=D._doc.createElement("p");X.appendChild(D._doc.createElement("br"));T.insertBefore(X,V?U.nextSibling:U);var W=D._getSelection();var S=D._createRange(W);if(!Xinha.is_ie){W.removeAllRanges();S.selectNodeContents(X);S.collapse(true);W.addRange(S)}else{S.moveToElementText(X);S.collapse(true);S.select()}}for(;H;H=H.parentNode){var Q=H.tagName;if(!Q){continue}Q=Q.toLowerCase();switch(Q){case"img":R=H;I.push(null,[Xinha._lc("_Image Properties...","ContextMenu"),function(){D._insertImage(R)},Xinha._lc("Show the image properties dialog","ContextMenu"),C.btnList.insertimage[1]]);break;case"a":G=H;I.push(null,[Xinha._lc("_Modify Link...","ContextMenu"),function(){D.config.btnList.createlink[3](D)},Xinha._lc("Current URL is","ContextMenu")+": "+G.href,C.btnList.createlink[1]],[Xinha._lc("Chec_k Link...","ContextMenu"),function(){window.open(G.href)},Xinha._lc("Opens this link in a new window","ContextMenu")],[Xinha._lc("_Remove Link...","ContextMenu"),function(){if(confirm(Xinha._lc("Please confirm that you want to unlink this element.","ContextMenu")+"\n"+Xinha._lc("Link points to:","ContextMenu")+" "+G.href)){while(G.firstChild){G.parentNode.insertBefore(G.firstChild,G)}G.parentNode.removeChild(G)}},Xinha._lc("Unlink the current element","ContextMenu")]);break;case"td":M=H;if(!L){break}I.push(null,[Xinha._lc("C_ell Properties...","ContextMenu"),function(){N("TO-cell-prop")},Xinha._lc("Show the Table Cell Properties dialog","ContextMenu"),C.btnList["TO-cell-prop"][1]],[Xinha._lc("Insert Cell After","ContextMenu"),function(){N("TO-cell-insert-after")},Xinha._lc("Insert Cell After","ContextMenu"),C.btnList["TO-cell-insert-after"][1]],[Xinha._lc("Insert Cell Before","ContextMenu"),function(){N("TO-cell-insert-before")},Xinha._lc("Insert Cell After","ContextMenu"),C.btnList["TO-cell-insert-before"][1]],[Xinha._lc("Delete Cell","ContextMenu"),function(){N("TO-cell-delete")},Xinha._lc("Delete Cell","ContextMenu"),C.btnList["TO-cell-delete"][1]],[Xinha._lc("Merge Cells","ContextMenu"),function(){N("TO-cell-merge")},Xinha._lc("Merge Cells","ContextMenu"),C.btnList["TO-cell-merge"][1]]);break;case"tr":A=H;if(!L){break}I.push(null,[Xinha._lc("Ro_w Properties...","ContextMenu"),function(){N("TO-row-prop")},Xinha._lc("Show the Table Row Properties dialog","ContextMenu"),C.btnList["TO-row-prop"][1]],[Xinha._lc("I_nsert Row Before","ContextMenu"),function(){N("TO-row-insert-above")},Xinha._lc("Insert a new row before the current one","ContextMenu"),C.btnList["TO-row-insert-above"][1]],[Xinha._lc("In_sert Row After","ContextMenu"),function(){N("TO-row-insert-under")},Xinha._lc("Insert a new row after the current one","ContextMenu"),C.btnList["TO-row-insert-under"][1]],[Xinha._lc("_Delete Row","ContextMenu"),function(){N("TO-row-delete")},Xinha._lc("Delete the current row","ContextMenu"),C.btnList["TO-row-delete"][1]]);break;case"table":E=H;if(!L){break}I.push(null,[Xinha._lc("_Table Properties...","ContextMenu"),function(){N("TO-table-prop")},Xinha._lc("Show the Table Properties dialog","ContextMenu"),C.btnList["TO-table-prop"][1]],[Xinha._lc("Insert _Column Before","ContextMenu"),function(){N("TO-col-insert-before")},Xinha._lc("Insert a new column before the current one","ContextMenu"),C.btnList["TO-col-insert-before"][1]],[Xinha._lc("Insert C_olumn After","ContextMenu"),function(){N("TO-col-insert-after")},Xinha._lc("Insert a new column after the current one","ContextMenu"),C.btnList["TO-col-insert-after"][1]],[Xinha._lc("De_lete Column","ContextMenu"),function(){N("TO-col-delete")},Xinha._lc("Delete the current column","ContextMenu"),C.btnList["TO-col-delete"][1]]);break;case"body":I.push(null,[Xinha._lc("Justify Left","ContextMenu"),function(){D.execCommand("justifyleft")},null,C.btnList.justifyleft[1]],[Xinha._lc("Justify Center","ContextMenu"),function(){D.execCommand("justifycenter")},null,C.btnList.justifycenter[1]],[Xinha._lc("Justify Right","ContextMenu"),function(){D.execCommand("justifyright")},null,C.btnList.justifyright[1]],[Xinha._lc("Justify Full","ContextMenu"),function(){D.execCommand("justifyfull")},null,C.btnList.justifyfull[1]]);break}}if(K&&!G){B.push(null,[Xinha._lc("Make lin_k...","ContextMenu"),function(){D.config.btnList.createlink[3](D)},Xinha._lc("Create a link","ContextMenu"),C.btnList.createlink[1]])}for(var P=0;P<I.length;++P){B.push(I[P])}if(!/html|body/i.test(J.tagName)){B.push(null,[Xinha._lc({string:"Remove the $elem Element...",replace:{elem:"&lt;"+J.tagName+"&gt;"}},"ContextMenu"),function(){if(confirm(Xinha._lc("Please confirm that you want to remove this element:","ContextMenu")+" "+J.tagName)){var T=J;var U=T.parentNode;U.removeChild(T);if(Xinha.is_gecko){if(U.tagName.toLowerCase()=="td"&&!U.hasChildNodes()){U.appendChild(D._doc.createElement("br"))}D.forceRedraw();D.focusEditor();D.updateToolbar();if(E){var S=E.style.borderCollapse;E.style.borderCollapse="collapse";E.style.borderCollapse="separate";E.style.borderCollapse=S}}}},Xinha._lc("Remove this node from the document","ContextMenu")],[Xinha._lc("Insert paragraph before","ContextMenu"),function(){O(false)},Xinha._lc("Insert a paragraph before the current node","ContextMenu")],[Xinha._lc("Insert paragraph after","ContextMenu"),function(){O(true)},Xinha._lc("Insert a paragraph after the current node","ContextMenu")])}if(!B[0]){B.shift()}return B};ContextMenu.prototype.popupMenu=function(Z){var L=this;if(this.currentMenu){this.closeMenu()}function S(c){var d={x:c.offsetLeft,y:c.offsetTop};if(c.offsetParent){var b=S(c.offsetParent);d.x+=b.x;d.y+=b.y}return d}function C(c){c||(c=window.event);if(!L.currentMenu){alert(Xinha._lc("How did you get here? (Please report!)","ContextMenu"));return false}var b=Xinha.is_ie?c.srcElement:c.target;for(;b!=null&&b!=L.currentMenu;b=b.parentNode){}if(b==null){L.closeMenu()}}var E=[];function N(e){e||(e=window.event);Xinha._stopEvent(e);if(e.keyCode==27){L.closeMenu();return false}var d=String.fromCharCode(Xinha.is_ie?e.keyCode:e.charCode).toLowerCase();for(var c=E.length;--c>=0;){var b=E[c];if(b[0].toLowerCase()==d){b[1].__msh.activate()}}}L.closeMenu=function(){L.currentMenu.parentNode.removeChild(L.currentMenu);L.currentMenu=null;Xinha._removeEvent(document,"mousedown",C);Xinha._removeEvent(L.editordoc,"mousedown",C);if(E.length>0){Xinha._removeEvent(L.editordoc,"keypress",N)}if(Xinha.is_ie){L.iePopup.hide()}};var J=Xinha.is_ie?Z.srcElement:Z.target;var I=S(L.editor._htmlArea);var G=Z.clientX+I.x;var F=Z.clientY+I.y;var M;var a;if(!Xinha.is_ie){a=document}else{var Y=this.iePopup=window.createPopup();a=Y.document;a.open();a.write("<html><head><style type='text/css'>@import url("+Xinha.getPluginDir("ContextMenu")+"/menu.css); html, body { padding: 0px; margin: 0px; overflow: hidden; border: 0px; }</style></head><body unselectable='yes'></body></html>");a.close()}M=a.createElement("div");if(Xinha.is_ie){M.unselectable="on"}M.oncontextmenu=function(){return false};M.className="htmlarea-context-menu";if(!Xinha.is_ie){M.style.left=M.style.top="0px"}a.body.appendChild(M);var X=a.createElement("table");M.appendChild(X);X.cellSpacing=0;X.cellPadding=0;var V=a.createElement("tbody");X.appendChild(V);var U=this.getContextMenu(J);for(var Q=0;Q<U.length;++Q){var P=U[Q];var O=a.createElement("tr");V.appendChild(O);if(Xinha.is_ie){O.unselectable="on"}else{O.onmousedown=function(b){Xinha._stopEvent(b);return false}}if(!P){O.className="separator";var D=a.createElement("td");D.className="icon";var W=">";if(Xinha.is_ie){D.unselectable="on";W=" unselectable='on' style='height=1px'>&nbsp;"}D.innerHTML="<div"+W+"</div>";var B=D.cloneNode(true);B.className="label";O.appendChild(D);O.appendChild(B)}else{var T=P[0];O.className="item";O.__msh={item:O,label:T,action:P[1],tooltip:P[2]||null,icon:P[3]||null,activate:function(){L.closeMenu();L.editor.focusEditor();this.action()}};T=T.replace(/_([a-zA-Z0-9])/,"<u>$1</u>");if(T!=P[0]){E.push([RegExp.$1,O])}T=T.replace(/__/,"_");var B=a.createElement("td");if(Xinha.is_ie){B.unselectable="on"}O.appendChild(B);B.className="icon";if(O.__msh.icon){var K=Xinha.makeBtnImg(O.__msh.icon,a);B.appendChild(K)}var A=a.createElement("td");if(Xinha.is_ie){A.unselectable="on"}O.appendChild(A);A.className="label";A.innerHTML=T;O.onmouseover=function(){this.className+=" hover";L.editor._statusBarTree.innerHTML=this.__msh.tooltip||"&nbsp;"};O.onmouseout=function(){this.className="item"};O.oncontextmenu=function(b){this.__msh.activate();if(!Xinha.is_ie){Xinha._stopEvent(b)}return false};O.onmouseup=function(c){var b=(new Date()).getTime();if(b-L.timeStamp>500){this.__msh.activate()}if(!Xinha.is_ie){Xinha._stopEvent(c)}return false}}}if(!Xinha.is_ie){M.style.left=G+"px";M.style.top=F+"px"}else{this.iePopup.show(Z.screenX,Z.screenY,300,50);var H=M.offsetWidth;var R=M.offsetHeight;this.iePopup.show(Z.screenX,Z.screenY,H,R)}this.currentMenu=M;this.timeStamp=(new Date()).getTime();Xinha._addEvent(document,"mousedown",C);Xinha._addEvent(this.editordoc,"mousedown",C);if(E.length>0){Xinha._addEvent(this.editordoc,"keypress",N)}Xinha._stopEvent(Z);return false};